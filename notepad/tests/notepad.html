<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Test Editor</title>

<!-- External Dependencies of notepad.js -->
<script src="../external/jquery-1.7.2.js" type="text/javascript"></script>
<script src="../external/jquery-ui.js" type="text/javascript"></script>
<link  href="../external/jquery-ui.css" type="text/css" rel="stylesheet" media="screen" />
<script src="../external/jquery.rdfquery.core-1.0.js" type="text/javascript"></script>
<script src="../external/jquery.rdfquery.rules-1.0.js" type="text/javascript"></script>
<script src="../external-modules/jquery-caret/jquery.caret.js" type="text/javascript"></script>
<script src="../external/subarray.js" type="text/javascript"></script>
<script src="../external/underscore.js" type="text/javascript"></script>

<!-- Notepad code -->
<script src="../notepad/notepad.js" type="text/javascript"></script>
<script src="../notepad/notepad-rdf.js" type="text/javascript"></script>
<script src="../notepad/notepad-container.js" type="text/javascript"></script>
<script src="../notepad/notepad-line.js" type="text/javascript"></script>
<script src="../notepad/notepad-sparql.js" type="text/javascript"></script>
<script src="../notepad/notepad-column.js" type="text/javascript"></script>
<script src="../notepad/notepad-object.js" type="text/javascript"></script>
<script src="../notepad/notepad-predicate.js" type="text/javascript"></script>

<link href="../css/notepad.css" rel="stylesheet" type="text/css" media="screen" />

<script src="../notepad/display-require-provide.js" type="text/javascript"></script>
<script src="../notepad/suggest-line.js" type="text/javascript"></script>

<script>
var devFusekiEndpoint;
var notepad;
var container;
var line1;
var log = function(l) { 
    console.log(l.toString());
}
$(function() {
    $("#notepad").notepad();
    notepad = $("#notepad").data('notepad');
    container = notepad.getContainer();
    line1 = notepad.getLines()[0];

    $("#notepad .notepad-object").focus();
    devFusekiEndpoint = new FusekiEndpoint("http://localhost:3030/dev");
    $("#notepad").data('notepad').endpoint = devFusekiEndpoint;

    // if ( (uri=window.location.hash.length) > 0) {
    //     notepad.setUri(uri);
    // }
    
    $("#save").click(function() {
        var sparql = $("#notepad").notepad('triples').sparql();
        $.each(sparql, function(i,command) {
            var log = $('<tr><td class="command"/></td><td class="result"/></tr>').insertBefore("#sparql tr:first");
            $(log).find('.command').text(command);
            var result = $(log).find(".result");

            devFusekiEndpoint.execute(command, function(response) {
                result.text(response);
            });
        });
    });
    $("#datepicker").datepicker();

    $(".debug .toggle").click(function() {
        $(this).siblings().toggleClass('hidden');
    });

    //  WHY is this failing?
    //container.appendColumn();
});
</script>
</head>
<body>
    <div id="container">
        <h2>Notepad</h2>
	   <div id="notepad"></div>
	   <button id="save">Save</button>
    </div>

    <div class="debug">
        <button class="toggle">Show/Hide Debug</button>
        <div id="sparql-results" class="hidden">
            <h4>SPARQL Commands</h4>
            <table id="sparql">
                <tr/>
            </table>
        </div>
        <input id="datepicker"></input>
    </div>
</body>
</html>